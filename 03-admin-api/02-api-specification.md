# Admin API Service - APIä»•æ§˜ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰

**ã‚«ãƒ†ã‚´ãƒª**: Backend Service API
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**æœ€çµ‚æ›´æ–°**: 2025-11-08

## ç›®æ¬¡
- [APIãƒ™ãƒ¼ã‚¹URL](#apiãƒ™ãƒ¼ã‚¹url)
- [èªè¨¼](#èªè¨¼)
- [APIä»•æ§˜æ›¸ä¸€è¦§](#apiä»•æ§˜æ›¸ä¸€è¦§)
- [ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹](#ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹)

---

## APIä»•æ§˜æ›¸ä¸€è¦§

Admin APIä»•æ§˜æ›¸ã¯æ©Ÿèƒ½åˆ¥ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ï¼š

### ğŸ“„ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†API](./02-api-documents.md)
- PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å‡¦ç†
- OCRãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- ç”»åƒåˆ‡ã‚Šå‡ºã—ãƒ»ä¿å­˜
- ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãƒ»RAGå‡¦ç†
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ï¼‰

### ğŸ”§ [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»ç§»å‹•API](./10-api-document-maintenance.md)
- å­¤ç«‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ãƒ»å‰Šé™¤
- å‡¦ç†ä¸­çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
- Collectioné–“ç§»å‹•
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»æ¨©é™ç®¡ç†

### âš™ï¸ [ã‚¸ãƒ§ãƒ–ç®¡ç†API](./02-api-jobs.md)
- ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»é€²æ—å–å¾—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã‚¸ãƒ§ãƒ–ä¸€è¦§
- ã‚¸ãƒ§ãƒ–ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½

### ğŸ“š [ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹API](./02-api-knowledge-bases.md)
- ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹CRUD
- ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆï¼ˆRAGï¼‰
- MCPãƒãƒ£ãƒƒãƒˆçµ±åˆï¼ˆ7æ®µéšRAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†

### ğŸ’¬ [ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç®¡ç†API](./07-api-chat-sessions.md)
- ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³CRUD
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¿å­˜ãƒ»å–å¾—
- ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½
- è‡ªå‹•ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ

### ğŸ” [ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢API](./08-api-hybrid-search.md)
- 7æ®µéšRAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- Atlaså±¤ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- Sparse + Denseæ¤œç´¢
- BM25 + Cross-Encoder Re-ranking

### ğŸ¢ [ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†API](./09-api-tenants.md)
- ãƒ†ãƒŠãƒ³ãƒˆCRUD
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢
- ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šç®¡ç†
- ç›£æŸ»ãƒ­ã‚°

### ğŸ”® [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆAPI](./02-api-prompt-templates.md)
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆCRUD
- ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—
- å¤‰æ•°ç½®æ›ãƒ‘ã‚¿ãƒ¼ãƒ³

### ğŸ–¥ï¸ [ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ»ãƒ­ã‚°API](./02-api-system-logs.md)
- ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»Redisã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- MCPã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ç®¡ç†
- ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»æ¤œç´¢

---

## APIãƒ™ãƒ¼ã‚¹URL

| ç’°å¢ƒ | ãƒ™ãƒ¼ã‚¹URL |
|------|----------|
| ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º | `http://localhost:8003/admin` |
| Dockerç’°å¢ƒ | `http://host.docker.internal:8003/admin` |
| Admin Frontend BFF | `/api/admin/*` (ãƒ—ãƒ­ã‚­ã‚·çµŒç”±) |

---

## èªè¨¼

### JWTèªè¨¼

å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ç®¡ç†è€…JWTãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…é ˆï¼ˆ`/healthz`é™¤ãï¼‰ã€‚

**Authorizationãƒ˜ãƒƒãƒ€ãƒ¼**:
```
Authorization: Bearer <jwt_token>
```

### ãƒ­ãƒ¼ãƒ«è¦ä»¶

| ãƒ­ãƒ¼ãƒ« | æ¨©é™ |
|--------|------|
| `admin` | åŸºæœ¬ç®¡ç†æ“ä½œï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ãƒ­ã‚°ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ï¼‰ |
| `super_admin` | é«˜åº¦ãªæ“ä½œï¼ˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ï¼‰ |

### TypeScriptèªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼

```typescript
// BFFçµŒç”±ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
async function authenticatedRequest<T>(
  url: string,
  options: RequestInit = {}
): Promise<T> {
  const response = await fetch(url, {
    ...options,
    credentials: 'include', // httpOnly cookieã‚’é€ä¿¡
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.detail || `HTTP ${response.status}`);
  }

  return response.json();
}
```

---

## APIä»•æ§˜ã®è©³ç´°

å„APIä»•æ§˜ã®è©³ç´°ã¯ã€ä¸Šè¨˜ã®[APIä»•æ§˜æ›¸ä¸€è¦§](#apiä»•æ§˜æ›¸ä¸€è¦§)ã‹ã‚‰è©²å½“ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

### æ¨™æº–ã‚¨ãƒ©ãƒ¼å½¢å¼

å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

```typescript
interface APIError {
  detail: string;                // ã‚¨ãƒ©ãƒ¼è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  status_code?: number;          // HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
}
```

### HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

| ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ | ä¾‹ |
|-------|------|---|
| 200 | æˆåŠŸ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ­£å¸¸å®Œäº† |
| 400 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸æ­£ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã€ä¸æ­£ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
| 401 | èªè¨¼ã‚¨ãƒ©ãƒ¼ | JWTãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ãƒ»æœŸé™åˆ‡ã‚Œ |
| 403 | èªå¯ã‚¨ãƒ©ãƒ¼ | æ¨©é™ä¸è¶³ï¼ˆadminãƒ­ãƒ¼ãƒ«å¿…è¦ãªã©ï¼‰ |
| 404 | ãƒªã‚½ãƒ¼ã‚¹æœªç™ºè¦‹ | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ç”»åƒãŒå­˜åœ¨ã—ãªã„ |
| 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | äºˆæœŸã—ãªã„å†…éƒ¨ã‚¨ãƒ©ãƒ¼ |
| 503 | ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ä¸å¯ | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»Redisæ¥ç¶šå¤±æ•— |

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¾‹

```typescript
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
async function apiRequest<T>(
  url: string,
  options: RequestInit = {}
): Promise<T> {
  try {
    const response = await fetch(url, {
      ...options,
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
    });

    if (!response.ok) {
      const error: APIError = await response.json();
      throw new Error(error.detail || `HTTP ${response.status}`);
    }

    return response.json();
  } catch (error) {
    console.error('API request failed:', error);
    throw error;
  }
}

// React Hookä½¿ç”¨ä¾‹
function useAdminAPI() {
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const request = async <T>(url: string, options?: RequestInit): Promise<T> => {
    setLoading(true);
    setError(null);

    try {
      const result = await apiRequest<T>(url, options);
      return result;
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Request failed';
      setError(errorMessage);
      throw err;
    } finally {
      setLoading(false);
    }
  };

  return { request, error, loading };
}
```

---

## ãƒ¬ãƒ¼ãƒˆåˆ¶é™

ç¾åœ¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã‚’æ¨å¥¨:

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ |
|--------------|----------|
| `/admin/documents/upload` | 10ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ† |
| `/admin/logs` | 100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ† |
| ãã®ä»– | 1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ† |

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### APIä»•æ§˜æ›¸
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†API](./02-api-documents.md)
- [ã‚¸ãƒ§ãƒ–ç®¡ç†API](./02-api-jobs.md)
- [ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹API](./02-api-knowledge-bases.md)
- [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆAPI](./02-api-prompt-templates.md)
- [ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ»ãƒ­ã‚°API](./02-api-system-logs.md)

### æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦](./01-overview.md)
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](./03-document-processing.md)
- [OCRè¨­è¨ˆ](./04-ocr-design.md)
- [éšå±¤æ§‹é€ å¤‰æ›](./05-hierarchy-converter.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](./06-database-design.md)