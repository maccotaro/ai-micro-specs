# 08. サービス間連携設計

マイクロサービス間の通信、認証フロー、データ整合性など、サービスをまたがる設計を定義します。

## 📄 ドキュメント一覧

### 01. サービス間通信設計書
`01-service-communication.md`

サービス間の通信プロトコル、エンドポイント呼び出し規約を定義します。

**主な内容**:
- HTTP通信プロトコル
- タイムアウト設定
- リトライ戦略
- サービスディスカバリ

### 02. 認証フロー統合設計書
`02-authentication-flow.md`

全サービスを通した認証フローを統合的に説明します。

**主な内容**:
- ログインシーケンス（Frontend → BFF → Auth Service → DB → Redis）
- 認証済みAPI呼び出しシーケンス
- トークンリフレッシュフロー
- ログアウトフロー

### 03. 認可フロー設計書
`03-authorization-flow.md`

権限チェック、ロールベースアクセス制御（RBAC）を説明します。

**主な内容**:
- ロール定義（user, admin）
- 権限チェックロジック
- リソースアクセス制御

### 04. JWT検証フロー設計書
`04-jwt-verification.md`

各APIサービスでのJWT検証プロセスを統合的に説明します。

**主な内容**:
- JWKS取得と公開鍵キャッシュ
- 署名検証（RS256）
- クレーム検証（iss, aud, exp等）
- ブラックリスト確認

### 05. データ整合性設計書
`05-data-consistency.md`

データベース間のデータ整合性管理を説明します。

**主な内容**:
- authdb.users ↔ apidb.profiles の user_id 同期
- admindb.documents の user_id 参照
- トランザクション境界
- 整合性担保方法

### 06. エラー伝播設計書
`06-error-propagation.md`

サービス間でのエラーハンドリングとエラー伝播を定義します。

**主な内容**:
- エラーコード体系
- エラーレスポンス形式
- エラーの伝播ルール
- ユーザー向けメッセージ変換

### 07. BFFパターン設計書
`07-bff-pattern.md`

Backend for Frontend パターンの実装を説明します。

**主な内容**:
- BFFの責務
- Cookie ↔ Header 変換
- リクエスト集約
- レスポンスキャッシュ

## 🎯 このセクションを読むべき人

- **全ての開発者**: サービス間の連携を理解するために必読
- **バックエンド開発者**: API間の呼び出しを実装する場合
- **フロントエンド開発者**: BFFの動作を理解する場合
- **アーキテクト**: システム全体の整合性を確認する場合

## 📊 図表ファイル

`diagrams/` ディレクトリには以下の図が含まれます:

- `login-sequence.png` - ログインシーケンス図
- `api-call-sequence.png` - API呼び出しシーケンス図
- `jwt-verification-flow.png` - JWT検証フロー図
- `data-sync-flow.png` - データ同期フロー図

## 🔗 関連ドキュメント

- [00-overview/02-microservices-integration.md](../00-overview/) - マイクロサービス連携概要
- [01-auth-service/](../01-auth-service/) - 認証サービス詳細
- [09-api-contracts/](../09-api-contracts/) - APIインターフェース定義
- [10-security/](../10-security/) - セキュリティ設計

---

**このセクションは、システムの心臓部です。サービス間の連携を正しく理解することが、システム全体の理解につながります。**